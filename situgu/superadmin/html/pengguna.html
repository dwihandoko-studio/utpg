{{ define "Pengguna" }}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Pengguna || SITUGU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="Sistem Usulan Tunjangan Guru Dinas Pendidikan dan Kebudayaan Kab. Lampung Tengah" name="description" />
  <meta content="handokowae.my.id" name="author" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="keywords" content="portal, layanan, portal layanan, situgu, Sistem Usulan Tunjangan Guru, portal layanan disdikbud, disdikbud, disdik, pendidikan, lampung, lampung tengah, pendidikan lampung tengah, dinas pendidikan, dinas pendidikan lampung tengah, dinas pendidikan dan kebudayaan, dinas pendidikan dan kebudayaan lampung tengah, kabupaten lampung tengah">

  <meta property="og:title" content="Sistem Usulan Tunjangan Guru Dinas Pendidikan dan Kebudayaan Kab. Lampung Tengah" />
  <meta property="og:url" content="{{ .base_url }}" />
  <meta property="og:image" content="{{ .base_url }}/favicon/android-icon-192x192.png" />
  <meta property="og:description" content="Sistem Usulan Tunjangan Guru Dinas Pendidikan dan Kebudayaan Kab. Lampung Tengah" />

  <meta itemprop="name" content="Sistem Usulan Tunjangan Guru Dinas Pendidikan dan Kebudayaan Kab. Lampung Tengah" />
  <meta itemprop="description" content="Sistem Usulan Tunjangan Guru Dinas Pendidikan dan Kebudayaan Kab. Lampung Tengah" />
  <meta itemprop="image" content="{{ .base_url }}/favicon/android-icon-192x192.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="{{ .base_url }}/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="{{ .base_url }}/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="{{ .base_url }}/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="{{ .base_url }}/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="{{ .base_url }}/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="{{ .base_url }}/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="{{ .base_url }}/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="{{ .base_url }}/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ .base_url }}/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="{{ .base_url }}/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ .base_url }}/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="{{ .base_url }}/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ .base_url }}/favicon/favicon-16x16.png">
  <link rel="manifest" href="{{ .base_url }}/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="{{ .base_url }}/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <style>
    .active-menu-href {
      color: #556ee6 !important;
    }
  </style>

  <link href="{{ .base_url }}/theme/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css" />
  <link href="{{ .base_url }}/theme/css/icons.min.css" rel="stylesheet" type="text/css" />
  <link href="{{ .base_url }}/theme/css/app.min.css" id="app-style" rel="stylesheet" type="text/css" />
  <link href="{{ .base_url }}/theme/libs/sweetalert2/sweetalert2.min.css" rel="stylesheet" type="text/css" />
  <link href="{{ .base_url }}/theme/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
  <link href="{{ .base_url }}/theme/libs/bootstrap-touchspin/jquery.bootstrap-touchspin.min.css" rel="stylesheet" type="text/css" />
  <link href="{{ .base_url }}/theme/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
  <link href="{{ .base_url }}/theme/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
  <link href="{{ .base_url }}/theme/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" />
  <script src="{{ .base_url }}/theme/libs/ckeditor5-custom/build/ckeditor.js"></script>
  <link href="{{ .base_url }}/theme/libs/dropzone/min/dropzone.min.css" rel="stylesheet" type="text/css" />

  <style>
    .preview-image-upload {
      position: relative;
    }

    .preview-image-upload .imagePreviewUpload {
      max-width: 300px;
      max-height: 300px;
      cursor: pointer;
    }

    .preview-image-upload .btn-remove-preview-image {
      display: none;
      position: absolute;
      top: 5px;
      left: 5px;
      background-color: #555;
      color: white;
      font-size: 16px;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
    }

    .imagePreviewUpload:hover+.btn-remove-preview-image,
    .btn-remove-preview-image:hover {
      display: block;
    }

    .ul-custom-style-sub-menu-action {
      list-style: none;
      padding-left: 0.5rem;
      border: 1px solid #ffffff2e;
      padding-top: 0.5rem;
      padding-right: 0.5rem;
      border-radius: 1.5rem;
    }

    .li-custom-style-sub-menu-action {
      border: 1px solid white;
      display: inline-block !important;
      padding: 0.3rem 0.5rem 0rem 0.3rem;
      margin-right: 0.3rem;
      margin-bottom: 0.5rem;
      border-radius: 2rem;
    }

    .custom-style-sub-menu-action {
      font-size: 1em;
      line-height: 1;
      height: 24px;
      color: #f6f6f6;
      display: inline-block;
      position: relative;
      text-align: center;
      font-weight: 500;
      box-sizing: border-box;
      margin-top: -15px;
      vertical-align: -webkit-baseline-middle;
    }
  </style>
  <script>
    if (sessionStorage.getItem("is_visited") === null) {
      sessionStorage.setItem("is_visited", "dark-mode-switch");
    }

    // sessionStorage.setItem("is_visited", "dark-mode-switch");
    const BASE_URL = '{{ .base_url }}';
  </script>
  <style>
    ._sorot-mouse:hover {
      background-color: #c3cbe4;
    }

    ._sorot-mouse:hover ._color-h-hover {
      color: #000 !important;
    }

    ._sorot-mouse:hover ._color-p-hover {
      color: #202022 !important;
    }
  </style>
</head>

<body data-topbar="dark" data-layout="horizontal" data-layout-size="boxed" class="loading-logout">

  <!-- Begin page -->
  <div id="layout-wrapper">
    {{ template "HeadersLoged"}}
    {{ template "TopBar"}}

    <div class="main-content" id="main-panel">
      <div class="page-content">
        <div class="container-fluid">
          <div class="row">
            <div class="col-12">
              <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                <h4 class="mb-sm-0 font-size-18">PENGGUNA</h4>

                <!-- <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Layouts</a></li>
                                    <li class="breadcrumb-item active">Horizontal Boxed Width</li>
                                </ol>
                            </div> -->

              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <div class="row">
                    <div class="col-6">
                      <h4 class="card-title">Data Pengguna</h4>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-3">
                      <div class="form-group level-block">
                        <label for="filter_level" class="form-control-label">Filter Role</label>
                        <select class="form-control filter-level" name="filter_level" id="filter_level" data-toggle="select22" title="Simple select" data-live-search="true" data-live-search-placeholder="Search ..." required>
                          <option value="">-- Pilih --</option>
                          <option value="1">Super Admin</option>
                          <option value="2">Admin</option>
                          <option value="3">OP Kecamatan</option>
                          <option value="4">OP Subrayon</option>
                          <option value="5">OP Sekolah</option>
                          <option value="6">Kepala Sekolah</option>
                          <option value="7">PTK</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <table id="data-datatables" class="table table-bordered dt-responsive  nowrap w-100">
                    <thead>
                      <tr>
                        <th data-orderable="false">#</th>
                        <th data-orderable="false">Aksi</th>
                        <!-- <th data-orderable="false">Status</th> -->
                        <th data-orderable="false">NPSN</th>
                        <th data-orderable="false">Nama</th>
                        <th data-orderable="false">E-mail</th>
                        <th data-orderable="false">No Handphone</th>
                        <th data-orderable="false">Role</th>
                      </tr>
                    </thead>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="content-detailModal" class="modal fade content-detailModal" tabindex="-1" role="dialog" aria-labelledby="content-detailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
          <div class="modal-content modal-content-loading">
            <div class="modal-header">
              <h5 class="modal-title" id="content-detailModalLabel">Details</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="contentBodyModal">
            </div>
          </div>
        </div>
      </div>
      {{ template "Footer" }}
    </div>
  </div>

  <script src="{{ .base_url }}/theme/libs/jquery/jquery.min.js"></script>
  <script src="{{ .base_url }}/theme/js/blockUI.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/metismenu/metisMenu.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/simplebar/simplebar.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/node-waves/waves.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/sweetalert2/sweetalert2.min.js"></script>
  <script src="{{ .base_url }}/theme/js/app.js"></script>

  <script src="{{ .base_url }}/theme/libs/select2/js/select2.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/bootstrap-maxlength/bootstrap-maxlength.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/datatables.net/js/jquery.dataTables.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/jszip/jszip.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/pdfmake/build/pdfmake.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/pdfmake/build/vfs_fonts.js"></script>
  <script src="{{ .base_url }}/theme/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
  <script src="{{ .base_url }}/theme/libs/dropzone/min/dropzone.min.js"></script>
  <script>
    function initSelect2Panel(event) {
      $('#' + event).select2({
        dropdownParent: "#main-panel"
      });
    }

    function reloadPage(action = "") {
      if (action === "") {
        document.location.href = "<?= current_url(true); ?>";
      } else {
        document.location.href = action;
      }
    }


    function actionDetail(event, title) {
      $.ajax({
        url: "pengguna/detail",
        type: 'POST',
        data: {
          id: event,
        },
        dataType: 'JSON',
        beforeSend: function() {
          $('div.main-content').block({
            message: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span>'
          });
        },
        success: function(resul) {
          
          $('div.main-content').unblock();
          if (resul.status !== 200) {
            Swal.fire(
              'Failed!',
              resul.message,
              'warning'
            );
          } else {
            $('#content-detailModalLabel').html('DETAIL PENGGUNA ' + title);
            $('.contentBodyModal').html(resul.data);
            $('.content-detailModal').modal({
              backdrop: 'static',
              keyboard: false,
            });
            $('.content-detailModal').modal('show');
          }
        },
        error: function() {
          $('div.main-content').unblock();
          Swal.fire(
            'Failed!',
            "Trafik sedang penuh, silahkan ulangi beberapa saat lagi.",
            'warning'
          );
        }
      });
    }


    $(document).ready(function() {
      initSelect2Panel('filter_level');

      let tableDatatables = $('#data-datatables').DataTable({
        "processing": true,
        "select": true,
        "serverSide": true,
        "order": [],
        "ajax": {
          "url": "pengguna/getall",
          "method": "POST",
          "dataType": "json",
          "processData": false, // avoid being transformed into a query string,
          "contentType": 'application/json',
          data: function(d) {
            d.startDate = "";
            d.endDate = "";
            d.role = $('#filter_level').val();
            return JSON.stringify(d);
          }
        },
        language: {
          processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span> ',
        },
        'columns': [{
          'data': '',
          "defaultContent": "",
          'name': 'No'
        }, {
          'data': 'id',
          "defaultContent": "",
          'name': 'Aksi'
        }, {
          'data': 'npsn',
          "defaultContent": "",
          'name': 'NPSN'
        }, {
          'data': 'fullname',
          "defaultContent": "",
          'name': 'Nama'
        }, {
          'data': 'email',
          "defaultContent": "",
          'name': 'E-mail'
        }, {
          'data': 'no_hp',
          "defaultContent": "",
          'name': 'No. HP'
        }, {
          'data': 'role_user',
          "defaultContent": "",
          'name': 'Role'
        }],
        "columnDefs": [{
            "searchable": false,
            "orderable": false,
            "targets": 0,
          }, {
            "searchable": false,
            "orderable": false,
            "targets": 1,
            "render": function(data, type, row) {
              console.log(row);
              let aksiButton = '';
              aksiButton += '<a href="javascript:actionDetail(\'';
              aksiButton += data;
              aksiButton += '\',\'';
              aksiButton += row.fullname.replace("'", "");
              aksiButton += '\');"><button type="button" class="btn btn-primary btn-sm btn-rounded waves-effect waves-light mr-2 mb-1">';
              aksiButton += '<i class="bx bxs-show font-size-16 align-middle"></i></button>';
              aksiButton += '</a>';
              aksiButton += '<a href="javascript:actionResetAkun(\'';
              aksiButton += data;
              aksiButton += '\',\'';
              aksiButton += row.fullname.replace("'", "");
              aksiButton += '\');"><button type="button" class="btn btn-warning btn-sm btn-rounded waves-effect waves-light mr-2 mb-1">';
              aksiButton += '<i class="bx bxs-lock-open-alt font-size-16 align-middle"></i></button>';
              aksiButton += '</a>';
              aksiButton += '<a href="javascript:actionEdit(\'';
              aksiButton += data;
              aksiButton += '\',\'';
              aksiButton += row.fullname.replace("'", "");
              aksiButton += '\');"><button type="button" class="btn btn-secondary btn-sm btn-rounded waves-effect waves-light mr-2 mb-1">';
              aksiButton += '<i class="bx bx-edit font-size-16 align-middle"></i></button>';
              aksiButton += '</a>';
              aksiButton += '<a href="javascript:actionHapus(\'';
              aksiButton += data;
              aksiButton += '\',\'';
              aksiButton += row.fullname.replace("'", "");
              aksiButton += '\');" class="delete" id="delete"><button type="button" class="btn btn-danger btn-sm btn-rounded waves-effect waves-light mr-2 mb-1">';
              aksiButton += '<i class="bx bx-trash font-size-16 align-middle"></i></button>';
              aksiButton += '</a>';

              return aksiButton;
            }
          }, {
            "searchable": false,
            "orderable": false,
            "targets": 6,
            "render": function(data, type, row) {
              switch (data) {
                case 1:
                  return 'SuperAdmin'
                  break;
                case 2:
                  return 'Admin'
                  break;
                case 3:
                  return 'OP Kecamatan'
                  break;
                case 4:
                  return 'OP Subrayon'
                  break;
                case 5:
                  return 'OP Sekolah'
                  break;
                case 6:
                  return 'Kepala Sekolah'
                  break;
                case 7:
                  return 'PTK'
                  break;

                default:
                  return 'Unuknown'
                  break;
              }
            }
          }
          // , {
          //   "targets": 3,
          //   "data": "thumnail",
          //   "render": function(data, type, row) {
          //     // console.log(row);
          //     return '<img width="100px" src="../image/' + data + '" />';
          //   }
          // }
        ],
        order: [
          [1, 'asc']
        ],
      });

      tableDatatables.on('draw.dt', function() {
        var PageInfo = $('#data-datatables').DataTable().page.info();
        tableDatatables.column(0, {
          page: 'current'
        }).nodes().each(function(cell, i) {
          cell.innerHTML = i + 1 + PageInfo.start;
        });
      });

      $('#filter_level').change(function() {
        tableDatatables.draw();
      });


    });

    function aksiLogout(e) {
      // e.preventDefault();
      const href = BASE_URL + "/logout";
      Swal.fire({
        title: 'Apakah anda yakin ingin keluar?',
        text: "Keluar Dari Aplikasi.",
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, Sign Out!'
      }).then((result) => {
        if (result.value) {
          $.ajax({
            url: href,
            type: 'GET',
            contentType: false,
            cache: false,
            beforeSend: function() {
              $('body.loading-logout').block({
                message: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span>'
              });
            },
            success: function(resMsg) {
              Swal.fire(
                'Berhasil!',
                "Anda berhasil logout.",
                'success'
              ).then((valRes) => {
                document.location.href = BASE_URL + "/auth";
              })
            },
            error: function() {
              $('body.loading-logout').unblock();
              Swal.fire(
                'Gagal!',
                "Trafik sedang penuh, silahkan ulangi beberapa saat lagi.",
                'warning'
              );
            }
          })
        }
      })
    };
  </script>
</body>

</html>
{{end}}